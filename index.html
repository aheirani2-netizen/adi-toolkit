<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ADI Reflective Log</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
    font-family:Arial;
    background:#111;
    color:white;
    padding:20px;
    max-width:900px;
    margin:auto;
}
h1{text-align:center;margin-bottom:5px;}
small{display:block;text-align:center;margin-bottom:20px;color:#aaa;}

input,textarea,select{
    width:100%;
    padding:10px;
    margin-bottom:15px;
    border-radius:8px;
    border:1px solid #444;
    background:#222;
    color:white;
    font-size:16px;
}
textarea{min-height:100px;}

button{
    width:100%;
    padding:12px;
    margin-top:10px;
    border:none;
    border-radius:8px;
    font-size:16px;
    cursor:pointer;
    background:white;
    color:black;
}

.scale{
    display:flex;
    margin-bottom:15px;
}
.scale div{
    flex:1;
    padding:8px;
    text-align:center;
    font-weight:bold;
    cursor:pointer;
}
.scale div:nth-child(-n+3){background:#d32f2f;}
.scale div:nth-child(n+4):nth-child(-n+6){background:#fbc02d;color:black;}
.scale div:nth-child(n+7){background:#2e7d32;}
.selected{outline:3px solid white;}

.pupil-bar{
    display:flex;
    gap:8px;
    margin-bottom:15px;
}
.pupil-bar select{flex:2;}
.pupil-bar button{flex:1;}

.total-hours{
    font-weight:bold;
    margin-bottom:15px;
}
.hide-print{margin-top:10px;}
</style>
</head>

<body>

<h1>LEARNER REFLECTIVE LOG</h1>
<small>Instructor: Alex Heirani</small>

<div id="formArea">

<div class="pupil-bar hide-print">
<select id="pupilSelect"></select>
<button onclick="addPupil()">Add</button>
<button onclick="deletePupil()">Delete</button>
</div>

<div class="total-hours">
Total Hours: <span id="totalHours">0</span>
</div>

<label>Lesson Duration (hours)</label>
<input type="number" step="0.5" id="lessonHours">

<label>Lesson Goal</label>
<textarea id="goal"></textarea>

<label>Initial Self Rating</label>
<div class="scale" id="scale1"></div>

<label>What didnâ€™t go well</label>
<textarea id="improve"></textarea>

<label>What could you do differently</label>
<textarea id="different"></textarea>

<label>What went well</label>
<textarea id="well"></textarea>

<label>Did you achieve the goal</label>
<textarea id="achieved"></textarea>

<label>Final Self Rating</label>
<div class="scale" id="scale2"></div>

<label>Additional Comments</label>
<textarea id="comments"></textarea>

</div>

<button class="hide-print" onclick="generatePDF()">Generate PDF</button>

<script>

let pupils = JSON.parse(localStorage.getItem("adiScreenshotV2")) || {};
let currentPupil=null;

function save(){ localStorage.setItem("adiScreenshotV2",JSON.stringify(pupils)); }

function loadDropdown(){
let select=document.getElementById("pupilSelect");
select.innerHTML="";
let names=Object.keys(pupils);
if(names.length===0){currentPupil=null;document.getElementById("totalHours").innerText="0";return;}
names.forEach(name=>{
let opt=document.createElement("option");
opt.value=name;
opt.text=name;
select.appendChild(opt);
});
if(!currentPupil||!pupils[currentPupil])currentPupil=names[0];
select.value=currentPupil;
updateDisplay();
}

function addPupil(){
let name=prompt("Enter pupil name:");
if(!name)return;
if(!pupils[name])pupils[name]={hours:0};
currentPupil=name;
save();
loadDropdown();
}

function deletePupil(){
if(!currentPupil)return;
if(confirm("Delete "+currentPupil+"?")){
delete pupils[currentPupil];
save();
currentPupil=null;
loadDropdown();
}
}

document.getElementById("pupilSelect").addEventListener("change",function(){
currentPupil=this.value;updateDisplay();
});

function updateDisplay(){
if(!currentPupil)return;
document.getElementById("totalHours").innerText=pupils[currentPupil].hours;
}

function createScale(id){
for(let i=1;i<=10;i++){
let div=document.createElement("div");
div.innerText=i;
div.onclick=function(){
[...this.parentElement.children].forEach(c=>c.classList.remove("selected"));
this.classList.add("selected");
this.parentElement.setAttribute("data-value",i);
};
document.getElementById(id).appendChild(div);
}}
createScale("scale1");
createScale("scale2");

function generatePDF(){

if(!currentPupil){alert("Select pupil first");return;}

let hours=parseFloat(lessonHours.value)||0;
pupils[currentPupil].hours+=hours;
save();
updateDisplay();

/* Hide buttons */
document.querySelectorAll(".hide-print").forEach(el=>el.style.display="none");

html2canvas(document.getElementById("formArea"),{
scale:2,
scrollY:-window.scrollY
}).then(canvas=>{

const { jsPDF } = window.jspdf;
let pdf=new jsPDF("p","mm","a4");

let imgWidth=210;
let pageHeight=297;
let imgHeight=canvas.height*imgWidth/canvas.width;
let heightLeft=imgHeight;
let position=0;

let imgData=canvas.toDataURL("image/jpeg",1.0);

pdf.addImage(imgData,"JPEG",0,position,imgWidth,imgHeight);
heightLeft-=pageHeight;

while(heightLeft>0){
position=heightLeft-imgHeight;
pdf.addPage();
pdf.addImage(imgData,"JPEG",0,position,imgWidth,imgHeight);
heightLeft-=pageHeight;
}

pdf.save("Lesson_"+currentPupil+".pdf");

/* Show buttons again */
document.querySelectorAll(".hide-print").forEach(el=>el.style.display="block");

});
}

loadDropdown();
</script>

</body>
</html>