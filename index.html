<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ADI Instructor Toolkit</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body { font-family: Arial, sans-serif; padding: 20px; max-width: 900px; margin: auto; transition: 0.3s; }
h1, h2 { text-align: center; }
textarea, input, select { width: 100%; padding: 8px; margin-bottom: 15px; font-size: 16px; }
button { padding: 12px; width: 100%; margin-bottom: 10px; font-size: 16px; }
.section { border-top: 1px solid #ccc; padding-top: 15px; margin-top: 20px; }
.dark { background-color: #1c1c1e; color: white; }
.dark textarea, .dark input, .dark select { background-color: #2c2c2e; color: white; border: 1px solid #444; }
</style>
</head>

<body>

<h1>ADI Instructor Toolkit</h1>
<h2>Instructor: Alex Heirani</h2>
<p><strong>Date:</strong> <span id="date"></span></p>

<div class="section">
<label>Select / Add Pupil</label>
<select id="pupilSelect" onchange="loadPupil()"></select>
<input type="text" id="newPupil" placeholder="Add New Pupil">
<button onclick="addPupil()">Add Pupil</button>
</div>

<div class="section">
<label>Lesson Objective</label>
<textarea id="objective"></textarea>

<label>Self Evaluation (1–10)</label>
<input type="number" id="rating" min="1" max="10" value="5">

<label>Strengths</label>
<textarea id="strengths"></textarea>

<label>Development Areas</label>
<textarea id="development"></textarea>

<label>Agreed Action Plan</label>
<textarea id="action"></textarea>
</div>

<div class="section">
<h3>Risk Management</h3>
<select id="risk">
<option value="Low">Low Risk</option>
<option value="Medium">Medium Risk</option>
<option value="High">High Risk</option>
</select>
</div>

<div class="section">
<h3>ADI Part 3 Competency Tracker</h3>
<div id="competencies"></div>
</div>

<div class="section">
<button onclick="saveLesson()">Save Lesson</button>
<button onclick="generatePDF()">Generate Professional PDF</button>
<button onclick="emailReport()">Email Report</button>
<button onclick="toggleDark()">Toggle Dark Mode</button>
</div>

<script>
document.getElementById("date").innerText =
new Date().toLocaleDateString('en-GB', { day:'numeric', month:'long', year:'numeric' });

const competencies = [
"Lesson Planning","Risk Management","Client-Centred Learning","Communication","Feedback Quality",
"Instruction Clarity","Adaptability","Safety Awareness","Independent Driving","Fault Identification",
"Remedial Action","Pupil Engagement","Goal Setting","Progress Tracking","Professionalism","Time Management","Reflective Practice"
];

competencies.forEach((c,i)=>{
document.getElementById("competencies").innerHTML +=
`<label><input type="checkbox" id="comp${i}"> ${c}</label><br>`;
});

function addPupil(){
const name = document.getElementById("newPupil").value.trim();
if(!name) return;
let pupils = JSON.parse(localStorage.getItem("pupils")||"[]");
if(!pupils.includes(name)) pupils.push(name);
localStorage.setItem("pupils",JSON.stringify(pupils));
loadPupilList();
document.getElementById("newPupil").value="";
}

function loadPupilList(){
let pupils = JSON.parse(localStorage.getItem("pupils")||"[]");
let select = document.getElementById("pupilSelect");
select.innerHTML="";
pupils.forEach(p=>{select.innerHTML += `<option value="${p}">${p}</option>`;});
}

function loadPupil(){
const pupil = document.getElementById("pupilSelect").value;
if(!pupil) return;
const lesson = JSON.parse(localStorage.getItem("lesson_"+pupil)||"{}");
objective.value = lesson.objective||"";
rating.value = lesson.rating||5;
strengths.value = lesson.strengths||"";
development.value = lesson.development||"";
action.value = lesson.action||"";
risk.value = lesson.risk||"Low";
}

function saveLesson(){
const pupil = document.getElementById("pupilSelect").value;
if(!pupil) return alert("Select a pupil");
const lesson = {
objective: objective.value,
rating: rating.value,
strengths: strengths.value,
development: development.value,
action: action.value,
risk: risk.value
};
localStorage.setItem("lesson_"+pupil,JSON.stringify(lesson));
alert("Lesson saved for "+pupil);
}

function formatBullets(text){return text.split("\n").map(line=>"• "+line).join("\n");}

function buildReport(){
const pupil = document.getElementById("pupilSelect").value||"";
return `
DVSA LESSON RECORD

Instructor: Alex Heirani
Pupil: ${pupil}
Date: ${document.getElementById("date").innerText}

-----------------------------------------

Lesson Objective:
${objective.value}

Self Evaluation:
${rating.value} / 10

Strengths Demonstrated:
${formatBullets(strengths.value)}

Areas for Development:
${formatBullets(development.value)}

Agreed Action Plan:
${formatBullets(action.value)}

Risk Level: ${risk.value}

-----------------------------------------

Competencies:
${competencies.map((c,i)=>document.getElementById("comp"+i).checked?"✔ "+c:"✖ "+c).join("\n")}

-----------------------------------------

Instructor: Alex Heirani
`;
}

function generatePDF(){
const { jsPDF } = window.jspdf;
const doc = new jsPDF();
doc.setFontSize(16);
doc.text("DVSA LESSON RECORD", 20, 20);
doc.setFontSize(12);
doc.text(buildReport(),20,30);
doc.save("DVSA_Lesson_Record.pdf");
}

function emailReport(){
const body = buildReport();
window.location.href = "mailto:?subject=DVSA Lesson Record&body="+encodeURIComponent(body);
}

function toggleDark(){document.body.classList.toggle("dark");}

loadPupilList();
</script>

</body>
</html>